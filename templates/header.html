<!-- –°–∫—Ä–∏–ø—Ç–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ —Ç–µ–º–æ—é -->
<script>
    // –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è Service Worker
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/static/js/sw.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful');
                })
                .catch(err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
        });
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ cookies
    function setCookie(name, value, days) {
        let expires = "";
        if (days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }

    function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for(let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) == ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–∏—Å—Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏
    function getSystemTheme() {
        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–µ–º–∏
    function setTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        if (document.getElementById('theme-toggle')) {
            document.getElementById('theme-toggle').checked = theme === 'dark';
        }
        setCookie('theme', theme, 365); // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç–µ–º—É –Ω–∞ —Ä—ñ–∫
    }

    // –ó–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è –ø–æ—á–∞—Ç–∫–æ–≤–æ—ó —Ç–µ–º–∏
    const savedTheme = getCookie('theme');
    const systemTheme = getSystemTheme();
    const initialTheme = savedTheme || systemTheme;
    setTheme(initialTheme);

    // –°–ª—ñ–¥–∫—É–≤–∞–Ω–Ω—è –∑–∞ –∑–º—ñ–Ω–æ—é —Å–∏—Å—Ç–µ–º–Ω–æ—ó —Ç–µ–º–∏
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
        if (!getCookie('theme')) {
            setTheme(e.matches ? 'dark' : 'light');
        }
    });
</script>

<!-- –ù–∞–≤—ñ–≥–∞—Ü—ñ–π–Ω–∞ –ø–∞–Ω–µ–ª—å -->
<nav class="navbar navbar-expand-lg">
    <div class="container">
        <a class="navbar-brand" href="/">SpiriWile</a>
        <div class="d-flex align-items-center">
            <button id="debug-holiday" class="btn btn-sm btn-outline-primary me-2 d-none" style="font-size: 1.2rem;" title="–ê–∫—Ç–∏–≤—É–≤–∞—Ç–∏ —Å–≤—è—Ç–∫–æ–≤–∏–π —Ä–µ–∂–∏–º">üéâ</button>
            <label class="theme-switch" title="–ó–º—ñ–Ω–∏—Ç–∏ —Ç–µ–º—É">
                <input type="checkbox" id="theme-toggle">
                <span class="slider"></span>
            </label>
            <button class="navbar-toggler ms-3" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/">–ì–æ–ª–æ–≤–Ω–∞</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/rules">–ü—Ä–∞–≤–∏–ª–∞</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/architecture">–ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞</a>
                </li>
            </ul>
        </div>
    </div>
</nav> 